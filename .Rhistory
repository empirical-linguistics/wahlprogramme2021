wordcloud(words = cdu200$Token, freq = cdu200$LLR/20, col = "black", scale = c(5, .05))
set.seed(1985)
png("wordclouds01.png", width = 6, height = 6, un = "in", res = 600)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(words = gruene200$Token, freq = gruene200$LLR/20, col = "green", scale = c(3, .01))
wordcloud(words = afd200$Token, freq = afd200$LLR/20, col = "blue", scale = c(6, .2))
wordcloud(words = fdp200$Token, freq = fdp200$LLR/20, col = "yellow3", scale = c(5, .05))
wordcloud(words = cdu200$Token, freq = cdu200$LLR/20, col = "black", scale = c(5, .05))
wordcloud(words = linke200$Token, freq = fdp200$LLR/20, col = "darkred", scale = c(4, .01))
wordcloud(words = spd200$Token, freq = spd200$LLR/20, col = "red", scale = c(3, .01))
dev.off()
par(mfrow = c(1,1))
par(mar = c(5, 4, 4, 2) + 0.1)
set.seed(1985)
png("wordclouds01.png", width = 6, height = 6, un = "in", res = 600)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(words = gruene200$Token, freq = gruene200$LLR/20, col = "green", scale = c(3, .01))
wordcloud(words = afd200$Token, freq = afd200$LLR/20, col = "blue", scale = c(6, .2))
wordcloud(words = fdp200$Token, freq = fdp200$LLR/20, col = "yellow3", scale = c(5, .05))
wordcloud(words = cdu200$Token, freq = cdu200$LLR/20, col = "black", scale = c(4, .05))
wordcloud(words = linke200$Token, freq = fdp200$LLR/20, col = "darkred", scale = c(4, .01))
wordcloud(words = spd200$Token, freq = spd200$LLR/20, col = "red", scale = c(3, .01))
dev.off()
par(mfrow = c(1,1))
par(mar = c(5, 4, 4, 2) + 0.1)
# CDU-Trigramme:
cdu_trigrams <- cdu_text %>% gsub("\\-\n", "", .) %>%  gsub("\n", " ", .) %>% gsub(" +", " ", .) %>% strsplit(., split = "\\.|\\?|!") %>% unlist %>% trimws %>% no_empty %>% as_tibble() %>% unnest_tokens(trigram, value, token="ngrams", n = 3) %>% na.omit
trigrams <- rbind(mutate(afd_trigrams, Partei = "afd"),
mutate(cdu_trigrams, Partei = "cdu"),
mutate(fdp_trigrams, Partei = "fdp"),
mutate(gruene_trigrams, Partei = "gruene"),
mutate(linke_trigrams, Partei = "linke"),
mutate(spd_trigrams, Partei = "spd"))
# Trigramme auszählen, pro Parteiprogramm:
tri_count <- trigrams %>% group_by(Partei, trigram) %>% summarise(
Freq = n()
)
# Trigramme auszählen, Parteiprogrammunabhängig:
tri_all <- trigrams %>% group_by(trigram) %>% summarise(
Freq_all = n()
)
# diese Tabelle mit der oben erstellten verbinden:
tri_count <- left_join(tri_count, tri_all)
# new LLR column for tri_count df:
tri_count$llr <- numeric(nrow(tri_count))
tri_count$p_value <- numeric(nrow(tri_count))
# get LLR for each party:
for(i in 1:length(unique(tri_count$Partei))) {
prt <- unique(tri_count$Partei)[i]
# current df:
df_not_cur <- tri_count[which(tri_count$Partei != prt),]
df_cur <- tri_count[which(tri_count$Partei == prt),]
tri_count[which(tri_count$Partei == prt),]$llr <- llr(freq1 = as.numeric(df_cur$Freq),
freq2 = as.numeric(df_cur$Freq_all),
corpus_size1 = sum(df_cur$Freq),
corpus_size2 = sum(df_not_cur$Freq_all))
# p-Werte hinzufügen:
tri_count[which(tri_count$Partei == prt),]$p_value <- pchisq(tri_count[which(tri_count$Partei == prt),]$llr, df = 1, lower.tail = FALSE)
}
# Funktion für odds ratio
odds_ratio <- Vectorize(function(freq1, freq2, corpus_size1, corpus_size2) {
observed <- matrix(c(freq1, corpus_size1 - freq1,
freq2, corpus_size2 - freq2),
ncol = 2)
return(
(observed[1,1] / observed[2,1]) / (observed[1,2] / observed[2,2])
)
})
# Normalisierte Frequenz hinzufügen
tri_count$fpmt_all <- numeric(nrow(tri_count))
tri_count$fpmt <- numeric(nrow(tri_count))
for(i in 1:length(unique(tri_count$Partei))) {
tri_count[tri_count$Partei==unique(tri_count$Partei)[i],]$fpmt <- filter(tri_count, Partei == unique(tri_count$Partei)[i])$Freq / nrow(filter(tri_count, Partei != unique(tri_count$Partei)[i]))
}
for(i in 1:length(unique(tri_count$Partei))) {
tri_count[tri_count$Partei==unique(tri_count$Partei)[i],]$fpmt_all <- filter(tri_count, Partei == unique(tri_count$Partei)[i])$Freq / nrow(filter(tri_count, Partei == unique(tri_count$Partei)[i]))
}
# Funktion anwenden
tri_count$odds_ratio <- numeric(nrow(tri_count))
for(i in 1:length(unique(tri_count$Partei))) {
prt = unique(tri_count$Partei)[i]
tri_count[tri_count$Partei==prt,]$odds_ratio <- odds_ratio(freq1 = filter(tri_count, Partei == prt)$Freq,
freq2 = filter(tri_count, Partei == prt)$Freq_all, corpus_size1 = nrow(filter(tri_count, Partei==prt)), corpus_size2 = nrow(filter(tri_count, Partei != prt)))
}
# Funktion, die ausgibt, ob eines von drei Wörtern in Stopwords enthalten ist:
in_stopwords <- Vectorize(function(x) {
x <- unlist(strsplit(x, " "))
return(length(which(x %in% stopwords("de"))))
})
# Funktion benutzen:
tri_count$in_stopwords <- unname(in_stopwords(tri_count$trigram))
# Bei der SPD schließen wir die Trigramme aus,
# die aus Boilerplate-ähnlichem Material bestehen
tri_count <- tri_count[which(!tri_count$trigram %in% c("parteivorstand 2021 seite",
"der spd kapitel", "spd parteivorstand 2021", "zukunftsprogramm der spd", "das zukunftsprogramm der", grep("(^| )kapitel( |$)|(^| )seite( |$)", tri_count$trigram, value = T))),]
# Wir schließen außerdem alle Trigramme aus, die nur aus Ziffern bestehen (bei der AfD sehr häufig, wohl wg. Seitenzahlen)
tri_count <- tri_count[grep("^([[:digit:]]| )+$", tri_count$trigram, invert = T),]
set.seed(1985)
# mit Stopwords:
png("trigram_wcs02a.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd")$trigram,
filter(tri_count, Partei == "spd")$llr,
scale = c(1.2, .01), colors = "red")
wordcloud(filter(tri_count, Partei == "linke")$trigram,
filter(tri_count, Partei == "linke")$llr,
scale = c(1.5, .01), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp")$trigram,
filter(tri_count, Partei == "fdp")$llr,
scale = c(4, .1), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(4, .1), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene")$trigram,
filter(tri_count, Partei == "gruene")$llr,
scale = c(1.5, .01), colors = "green")
wordcloud(filter(tri_count, Partei == "afd")$trigram,
filter(tri_count, Partei == "afd")$llr,
scale = c(2, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
# nur ohne Stopwords:
png("trigram_wcs02b.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "spd", in_stopwords == 0)$llr,
scale = c(1.5, .001), colors = "red")
wordcloud(filter(tri_count, Partei == "linke", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "linke", in_stopwords == 0)$llr*2,
scale = c(1, .2), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "fdp", in_stopwords == 0)$llr,
scale = c(4, .2), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "cdu", in_stopwords == 0)$llr,
scale = c(4, .2), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene", in_stopwords==0)$trigram,
filter(tri_count, Partei == "gruene", in_stopwords == 0)$llr*3,
scale = c(1, .001), colors = "green")
wordcloud(filter(tri_count, Partei == "afd", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "afd", in_stopwords == 0)$llr,
scale = c(1.5, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(1.5, .01), colors = "black")
set.seed(1985)
# mit Stopwords:
png("trigram_wcs02a.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd")$trigram,
filter(tri_count, Partei == "spd")$llr,
scale = c(1.2, .01), colors = "red")
wordcloud(filter(tri_count, Partei == "linke")$trigram,
filter(tri_count, Partei == "linke")$llr,
scale = c(1.5, .01), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp")$trigram,
filter(tri_count, Partei == "fdp")$llr,
scale = c(4, .1), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(1.5, .01), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene")$trigram,
filter(tri_count, Partei == "gruene")$llr,
scale = c(1.5, .01), colors = "green")
wordcloud(filter(tri_count, Partei == "afd")$trigram,
filter(tri_count, Partei == "afd")$llr,
scale = c(2, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
# nur ohne Stopwords:
png("trigram_wcs02b.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "spd", in_stopwords == 0)$llr,
scale = c(1.5, .001), colors = "red")
wordcloud(filter(tri_count, Partei == "linke", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "linke", in_stopwords == 0)$llr*2,
scale = c(1, .2), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "fdp", in_stopwords == 0)$llr,
scale = c(4, .2), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "cdu", in_stopwords == 0)$llr,
scale = c(4, .2), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene", in_stopwords==0)$trigram,
filter(tri_count, Partei == "gruene", in_stopwords == 0)$llr*3,
scale = c(1, .001), colors = "green")
wordcloud(filter(tri_count, Partei == "afd", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "afd", in_stopwords == 0)$llr,
scale = c(1.5, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(1.5, .001), colors = "black")
set.seed(1985)
# mit Stopwords:
png("trigram_wcs02a.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd")$trigram,
filter(tri_count, Partei == "spd")$llr,
scale = c(1.2, .01), colors = "red")
wordcloud(filter(tri_count, Partei == "linke")$trigram,
filter(tri_count, Partei == "linke")$llr,
scale = c(1.5, .01), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp")$trigram,
filter(tri_count, Partei == "fdp")$llr,
scale = c(4, .1), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(2, .01), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene")$trigram,
filter(tri_count, Partei == "gruene")$llr,
scale = c(1.5, .01), colors = "green")
wordcloud(filter(tri_count, Partei == "afd")$trigram,
filter(tri_count, Partei == "afd")$llr,
scale = c(2, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
# nur ohne Stopwords:
png("trigram_wcs02b.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "spd", in_stopwords == 0)$llr,
scale = c(1.5, .001), colors = "red")
wordcloud(filter(tri_count, Partei == "linke", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "linke", in_stopwords == 0)$llr*2,
scale = c(1, .2), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "fdp", in_stopwords == 0)$llr,
scale = c(4, .2), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "cdu", in_stopwords == 0)$llr,
scale = c(1.5, .02), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene", in_stopwords==0)$trigram,
filter(tri_count, Partei == "gruene", in_stopwords == 0)$llr*3,
scale = c(1, .001), colors = "green")
wordcloud(filter(tri_count, Partei == "afd", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "afd", in_stopwords == 0)$llr,
scale = c(1.5, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
set.seed(1985)
# mit Stopwords:
png("trigram_wcs02a.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd")$trigram,
filter(tri_count, Partei == "spd")$llr,
scale = c(1.2, .01), colors = "red")
wordcloud(filter(tri_count, Partei == "linke")$trigram,
filter(tri_count, Partei == "linke")$llr,
scale = c(1.5, .01), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp")$trigram,
filter(tri_count, Partei == "fdp")$llr,
scale = c(4, .1), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(2, .1), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene")$trigram,
filter(tri_count, Partei == "gruene")$llr,
scale = c(1.5, .01), colors = "green")
wordcloud(filter(tri_count, Partei == "afd")$trigram,
filter(tri_count, Partei == "afd")$llr,
scale = c(2, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
# nur ohne Stopwords:
png("trigram_wcs02b.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "spd", in_stopwords == 0)$llr,
scale = c(1.5, .001), colors = "red")
wordcloud(filter(tri_count, Partei == "linke", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "linke", in_stopwords == 0)$llr*2,
scale = c(1, .2), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "fdp", in_stopwords == 0)$llr,
scale = c(4, .2), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "cdu", in_stopwords == 0)$llr,
scale = c(1, .005), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene", in_stopwords==0)$trigram,
filter(tri_count, Partei == "gruene", in_stopwords == 0)$llr*3,
scale = c(1, .001), colors = "green")
wordcloud(filter(tri_count, Partei == "afd", in_stopwords == 0)$trigram,
filter(tri_count, Partei == "afd", in_stopwords == 0)$llr,
scale = c(1.5, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(2, .1), colors = "black")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(2.5, .2), colors = "black")
warnings()
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(2.5, .05), colors = "black")
warnings()
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr,
scale = c(1, .05), colors = "black")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr/2,
scale = c(1, .05), colors = "black")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr/2,
scale = c(2, .05), colors = "black")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr/2,
scale = c(2, .1), colors = "black")
set.seed(1985)
# mit Stopwords:
png("trigram_wcs02a.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd")$trigram,
filter(tri_count, Partei == "spd")$llr,
scale = c(1.2, .01), colors = "red")
wordcloud(filter(tri_count, Partei == "linke")$trigram,
filter(tri_count, Partei == "linke")$llr,
scale = c(1.5, .01), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp")$trigram,
filter(tri_count, Partei == "fdp")$llr,
scale = c(4, .1), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr/2,
scale = c(2, .1), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene")$trigram,
filter(tri_count, Partei == "gruene")$llr,
scale = c(1.5, .01), colors = "green")
wordcloud(filter(tri_count, Partei == "afd")$trigram,
filter(tri_count, Partei == "afd")$llr,
scale = c(2, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr/2,
scale = c(2, .01), colors = "black")
set.seed(1985)
# mit Stopwords:
png("trigram_wcs02a.png", width = 6, height = 6, un = "in", res = 1200)
# svglite("trigram_wcs02.svg", width = 6, height = 6)
par(mfrow = c(3,2))
par(mar = c(1, 1, 1, 1) + 0.1)
wordcloud(filter(tri_count, Partei == "spd")$trigram,
filter(tri_count, Partei == "spd")$llr,
scale = c(1.2, .01), colors = "red")
wordcloud(filter(tri_count, Partei == "linke")$trigram,
filter(tri_count, Partei == "linke")$llr,
scale = c(1.5, .01), colors = "darkred")
wordcloud(filter(tri_count, Partei == "fdp")$trigram,
filter(tri_count, Partei == "fdp")$llr,
scale = c(4, .1), colors = "yellow3")
wordcloud(filter(tri_count, Partei == "cdu")$trigram,
filter(tri_count, Partei == "cdu")$llr/2,
scale = c(2, .01), colors = "black")
wordcloud(filter(tri_count, Partei == "gruene")$trigram,
filter(tri_count, Partei == "gruene")$llr,
scale = c(1.5, .01), colors = "green")
wordcloud(filter(tri_count, Partei == "afd")$trigram,
filter(tri_count, Partei == "afd")$llr,
scale = c(2, .01), colors = "blue")
dev.off()
par(mar = c(5, 4, 4, 2) + 0.1)
par(mfrow = c(1,1))
# packages ----------------------------------------------------------------
library(tidyverse)
library(tidytext)
library(pdftools)
library(wordcloud)
library(stopwords)
library(DT)
spd_text <- readRDS("spd.Rds")
cdu_text <- readRDS("cdu.Rds")
fdp_text <- readRDS("fdp.Rds")
gruene_text <- readRDS("gruene.Rds")
afd_text <- readRDS("afd.Rds")
linke_text <- readRDS("linke.Rds")
# re-import Trafilatura version
linke_trafi <- readRDS("linke_trafi.Rds")
dwds <- read_delim("dwds_kern_frequency_list.txt", delim = "\t", quote = "", col_names = c("Freq", "Token"))
count_tokens <- function(d) {
# Interpunktion und Zeilenumbrüche weg:
d <- gsub("[[:punct:]]|\n", " ", d)
# Tabstopps und mehrere Leerzeichen durch einfache Leerzeichen ersetzen:
d <- gsub("\t| +", " ", d)
# Groß- und Kleinschreibung entfernen:
d <- tolower(d)
# an Leerzeichen splitten, um an die Einzelwörter zu kommen:
d <- unlist(strsplit(d, " "))
# Wörter auszählen:
d <- table(d) %>% as.data.frame %>% arrange(desc(Freq))
# Spaltennamen umbenennen:
colnames(d) <- c("Token", "Freq")
return(d)
}
# Funktion auf die einzelnen Wahlprogramme anwenden:
fdp <- count_tokens(fdp_text)
spd <- count_tokens(spd_text)
afd <- count_tokens(afd_text)
gruene <- count_tokens(gruene_text)
linke <- count_tokens(linke_text)
cdu <- count_tokens(cdu_text)
# diese Hilfsfunktion berechnet die erwarteten Frequenzen:
exp2x2 <- function(observed) {
return(matrix(
c(
sum(observed[1,]) * sum(observed[,1]) / sum(observed),
sum(observed[2,]) * sum(observed[,1]) / sum(observed),
sum(observed[1,]) * sum(observed[,2]) / sum(observed),
sum(observed[2,]) * sum(observed[,2]) / sum(observed)
),
ncol = 2
))
}
# diese Funktion berechnet die Log-Likelihood Ratio:
llr <- Vectorize(function(freq1, freq2, corpus_size1, corpus_size2) {
observed <- matrix(c(freq1, corpus_size1 - freq1,
freq2, corpus_size2 - freq2),
ncol = 2)
expected <- exp2x2(observed)
return(2 * sum(ifelse(observed > 0, observed * log(observed / expected), 0)))
})
dice <- Vectorize(function(freq1, freq2, corpus_size1, corpus_size2) {
observed <- matrix(c(freq1, corpus_size1 - freq1,
freq2, corpus_size2 - freq2),
ncol = 2)
return(2 * observed[1, 1] / sum(observed[1, 1], observed[1, 2],
observed[1, 1], observed[2, 1]))
})
# Wahlprogramme:
gruene_size <- sum(gruene$Freq)
spd_size <- sum(spd$Freq)
fdp_size <- sum(fdp$Freq)
cdu_size <- sum(cdu$Freq)
afd_size <- sum(afd$Freq)
linke_size <- sum(linke$Freq)
# DWDS:
dwds_size <- sum(dwds$Freq)
# Spaltennamen ändern, um Gesamtfrequenz von FDP-Frequenz unterscheiden zu können:
colnames(cdu) <- c("Token", "Freq_cdu")
# DWDS-Frequenzen hinzufügen:
cdu <- left_join(cdu, dwds)
# NAs durch 0 ersetzen
cdu <- replace_na(cdu, list(Freq = 0, Freq_cdu = 0))
# Spalte mit Log-Likelihood hinzufügen:
cdu <- cdu %>% mutate(LLR = llr(cdu$Freq_cdu, cdu$Freq, cdu_size, dwds_size))
# Spalte mit Dice hinzufügen:
cdu <- cdu %>% mutate(Dice = dice(cdu$Freq_cdu, cdu$Freq, cdu_size, dwds_size)) %>% arrange(desc(LLR))
# Top 10, nach LLR sortiert (über arrange(desc(LLR)), s.o.)
cdu %>% head(10)
# nach Dice sortieren:
cdu %>% arrange(desc(Dice)) %>% head(10)
association_measures <- function(df) {
# welche Partei ist gerade dran? mit deparse(substitute())
# erhalten wir den Namen der Partei als character string:
partei <- deparse(substitute(df))
# das ist wichtig, weil wir die size-Variable der
# entsprechenden Partei brauchen.
df_size <- get(paste0(partei, "_size"))
# Spaltennamen ändern, um Gesamtfrequenz von df-Frequenz unterscheiden zu können:
colnames(df) <- c("Token", "Freq_df")
# DWDS-Frequenzen hinzufügen:
df <- left_join(df, dwds)
# NAs durch 0 ersetzen
df <- replace_na(df, list(Freq = 0, Freq_df = 0))
# Spalten mit Log-Likelihood, Dice und p-Wert hinzufügen:
df <- df %>% mutate(LLR = llr(df$Freq_df, df$Freq, df_size, dwds_size),
Dice = dice(df$Freq_df, df$Freq, df_size, dwds_size),
p = pchisq(LLR, df = 1, lower.tail = FALSE)) %>% arrange(desc(LLR))
# ausgeben
return(df)
}
# auf die einzelnen Parteien angewendet:
spd <- association_measures(spd)
cdu <- association_measures(cdu)
cdu
head(cdu)
fdp <- association_measures(fdp)
